---
title: "Group Project"
author: "Wang Pei"
date: "10/21/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r loading library}
library(tidyr)
library(dplyr)

```

```{r reading data, echo=TRUE}
card = read.csv("card.csv", header = TRUE, skip = 1)

# Rename pay_0 to pay_1, "default.payment.next.month" as 'target'
names(card)[names(card) == "PAY_0"] <- "PAY_1"
names(card)[names(card) == "default.payment.next.month"] <- "TARGET"

# Configure data types
# Categorical
card$SEX = as.factor(card$SEX)
card$MARRIAGE = as.factor(card$MARRIAGE)
card$TARGET = as.factor(card$TARGET)
# ordinal
card$EDUCATION = as.factor(card$EDUCATION)
```

```{r data information}
describe(card[,c('LIMIT_BAL')]) # Broad range
hist(card$LIMIT_BAL)
```

```{r Data exploration}
# Categorical data
describe(card[,c('SEX', 'EDUCATION', 'MARRIAGE')]) 
barplot(table(card$SEX))
barplot(table(card$EDUCATION))
barplot(table(card$MARRIAGE))
# SEX looks fine
# Education: 0 undocumented. 5,6 others
# Marriage: 0 undocumented. 3 others
```

```{r data}
describe(card$AGE)
hist(card$AGE)
```

```{r data}
describe(card[,c('PAY_1', 'PAY_2', 'PAY_3', 'PAY_4', 'PAY_5', 'PAY_6')]) 
hist(card[,c('PAY_1', 'PAY_2', 'PAY_3', 'PAY_4', 'PAY_5', 'PAY_6')])
# -2 undo
# -2, -1, 0 should be combined as 0
```


```{r data}
describe(card[,c('BILL_AMT1', 'BILL_AMT2', 'BILL_AMT3', 'BILL_AMT4', 'BILL_AMT5', 'BILL_AMT6')]) 
# Negative values can be interpreted as credit? Has to be investigated
hist(card[,c('BILL_AMT1', 'BILL_AMT2', 'BILL_AMT3', 'BILL_AMT4', 'BILL_AMT5', 'BILL_AMT6')])
```

```{r data}
describe(card[,c('PAY_AMT1', 'PAY_AMT2', 'PAY_AMT3', 'PAY_AMT4', 'PAY_AMT5', 'PAY_AMT6')]) 

hist(card[,c('PAY_AMT1', 'PAY_AMT2', 'PAY_AMT3', 'PAY_AMT4', 'PAY_AMT5', 'PAY_AMT6')])
```

```{r Data cleaning}
# Education: combine 0, 5, 6 -> 5
# Marriage: 0 -> 3
# PAY_i: -2, -1, 0 -> 0
# Check large pay_amt for outliers
card$EDUCATION[card$EDUCATION==0 | card$EDUCATION==5 | card$EDUCATION==6] = 5
card$MARRIAGE[card$MARRIAGE==0] = 3
card$PAY_1[card$PAY_1==-2 | card$PAY_1==-1] = 0
card$PAY_2[card$PAY_2==-2 | card$PAY_2==-1] = 0
card$PAY_3[card$PAY_3==-2 | card$PAY_3==-1] = 0
card$PAY_4[card$PAY_4==-2 | card$PAY_4==-1] = 0
card$PAY_5[card$PAY_5==-2 | card$PAY_5==-1] = 0
card$PAY_6[card$PAY_6==-2 | card$PAY_6==-1] = 0


describe(card[,c("EDUCATION","MARRIAGE")])
barplot(table(card$EDUCATION))
barplot(table(card$MARRIAGE))
describe(card[,c('PAY_1', 'PAY_2', 'PAY_3', 'PAY_4', 'PAY_5', 'PAY_6')]) 
hist(card[,c('PAY_1', 'PAY_2', 'PAY_3', 'PAY_4', 'PAY_5', 'PAY_6')])
```

```{r plot data, echo=TRUE}
library(Hmisc)
library(corrplot)

res <- cor(as.matrix(card[,-c(1,3,4,5,25)]))
# Use rcorr from Hmisc
# res <- rcorr(as.matrix(train.data[,1:7]))
corrplot(res, method="circle")
corrplot(res, method="number")
# Bill_AMT 1 - 6 high correlation
```

```{r averaging}
card$PAY_AVG = colMeans(card[,7:12])
card$BILL_AVG = colMeans(card[,13:18])
card$AMT_AVG = colMeans(card[,19:24])
card[,7:24] = NULL

card$LIMIT_BAL = (card$LIMIT_BAL - mean(card$LIMIT_BAL)) / sd(card$LIMIT_BAL)

```

```{r data split}
set.seed(666)

index = 1:nrow(card)
n = nrow(card)
testIndex = sample(index, trunc(n)/3)

testSet = card[testIndex,]
trainSet = card[-testIndex, ]
```